webpackJsonp([9],{"0HId":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("BUOS"),r={name:"login",data:function(){return{Form:{username:"",psd:""},rules:{username:[{required:!0,message:"请输入用户名"}],psd:[{required:!0,message:"请输入密码"}]},dialogVisible:!1,canvas:null,ctx:null,mediaStreamTrack:null,ismatch:!1,timer:null}},methods:{closeBefore:function(){clearInterval(this.timer)},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.$http.post("/api/back/login",t.Form).then(function(e){e.data&&"passpsd"===e.data.login&&(e.data.faceAuth?t.showCamera():t.$router.push("/"))}).catch(function(e){e.response&&403===e.response.status&&t.$message({showClose:!0,message:"请输入正确的用户名和密码！",type:"error"})})})},showCamera:function(){this.dialogVisible=!0},getMedia:function(){var e=this,t=this,a=t.$refs["camera-video-login"];navigator.mediaDevices.getUserMedia({video:{width:300,height:300},audio:!1}).then(function(s){t.mediaStreamTrack=s,a.srcObject=s,a.play(),e.matchImg()})},takePhotoData:function(){var e=this.$refs["camera-video-login"];return this.canvas=this.$refs["camera-canvas-login"],this.ctx=this.canvas.getContext("2d"),this.ctx.drawImage(e,0,0,200,200),this.canvas.toDataURL("image/jpeg")},matchImg:function(){var e=this;this.timer=setInterval(function(){Object(s.g)({img:e.takePhotoData()}).then(function(t){t.data.result&&t.data.result.score>85&&(clearInterval(e.timer),e.$router.push("/"))})},1e3)},destroyedCamera:function(){this.mediaStreamTrack&&this.mediaStreamTrack.getTracks().forEach(function(e){e.stop()})}},destroyed:function(){this.destroyedCamera()}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"lg-wrapper"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.Form,rules:e.rules}},[a("el-form-item",{attrs:{prop:"username"}},[a("embed",{staticClass:"icon-input user",attrs:{src:"/static/img/user.svg"}}),e._v(" "),a("el-input",{model:{value:e.Form.username,callback:function(t){e.$set(e.Form,"username",t)},expression:"Form.username"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"psd"}},[a("embed",{staticClass:"icon-input user",attrs:{src:"/static/img/password.svg"}}),e._v(" "),a("el-input",{attrs:{autocomplete:"new-password",type:"password","show-password":""},model:{value:e.Form.psd,callback:function(t){e.$set(e.Form,"psd",t)},expression:"Form.psd"}})],1),e._v(" "),a("el-form-item",{staticClass:"form-btn-el"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("登录")])],1),e._v(" "),a("ul",{staticClass:"item-wp-user"},[a("li",[a("router-link",{attrs:{to:"/register"}},[e._v("注册账号")])],1),e._v(" "),a("li",[a("router-link",{attrs:{to:"/forgetpsd"}},[e._v("忘记密码")])],1)])],1),e._v(" "),a("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,width:"240px",height:"200px"},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.closeBefore,opened:e.getMedia}},[a("div",{staticClass:"dialog-video-wp"},[a("video",{ref:"camera-video-login",attrs:{src:"",width:"200px",height:"200px"}}),e._v(" "),a("div",{staticClass:"line"})]),e._v(" "),a("canvas",{ref:"camera-canvas-login",staticClass:"login-cemera-canvas",attrs:{width:"300px",height:"300px"}})])],1)},staticRenderFns:[]};var o=a("/4AN")(r,i,!1,function(e){a("YLvL")},null,null);t.default=o.exports},YLvL:function(e,t){}});
//# sourceMappingURL=9.a61bdf67a0a83b501b58.js.map